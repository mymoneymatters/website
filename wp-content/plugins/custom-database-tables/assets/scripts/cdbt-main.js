/*!
 * Custom DataBase Tables v2.0.8 (http://ka2.org)
 * Copyright 2014-2016 ka2@ka2.org
 * Licensed under GPLv2 (http://www.gnu.org/licenses/gpl.txt)
 */
function setCookie(e,t,a){var r="/",n=(new Date).getTime(),i=new Date(n+864e5*a),o=i.toUTCString(),d=new Array(t),s=d.filter(function(e,t,a){return a.indexOf(e)===t}),c="";c+=e+"="+escape(s.join(",")),c+="; path="+r,c+=a?"; expires="+o+"; ":"; ",document.cookie=c}function getCookie(e){var t="",a="",r="";return document.cookie.length>0&&(t=document.cookie.indexOf(e+"="),-1!==t&&(t=t+e.length+1,a=document.cookie.indexOf(";",t),-1===a&&(a=document.cookie.length),r=unescape(document.cookie.substring(t,a)))),r}function removeCookie(e){var t="/";e&&-1===document.cookie.indexOf(e+"=")&&(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:""))}jQuery(document).ready(function(e){e.QueryString=function(e){if(""===e)return{};for(var t={},a=0;a<e.length;++a){var r=e[a].split("=");2===r.length&&(t[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))}return t}(window.location.search.substr(1).split("&")),e.isDebug="true"===cdbt_main_vars.is_debug?!0:!1,e.ajaxUrl=cdbt_main_vars.ajax_url,e.nonce="",e.modalNotices="true"===cdbt_main_vars.notices_via_modal?!0:!1,e.emitMessage=cdbt_main_vars.emit_message,e.emitType=cdbt_main_vars.emit_type,e.localErrMsg=decodeURIComponent(cdbt_main_vars.local_err_msg.replace(/\+/g," ")),e.onTimer=!0,e.isDebug&&console.info(e.extend({debugMode:"ON",modalNotices:e.modalNotices,onTimer:e.onTimer},e.QueryString)),e.ajaxResponse={};var t=function(){this.reload_timer=function(){if(e.onTimer){var t=new Date;e(".cdbt-datepicker").datepicker("getDate",t),e('.datepicker-combobox-hour[data-on-timer="true"] input[type="text"]').val(("00"+t.getHours()).slice(-2)),e('.datepicker-combobox-minute[data-on-timer="true"] input[type="text"]').val(("00"+t.getMinutes()).slice(-2)),e('.datepicker-combobox-second[data-on-timer="true"] input[type="text"]').val(("00"+t.getSeconds()).slice(-2))}},this.render_modal=function(){e("div.cdbt-modal").size()>0&&(e("div.cdbt-modal").remove(),e("#append-dynamic-modal").remove()),e("body").append(e.ajaxResponse.responseText)},this.load_into_modal=function(){if(e("div.cdbt-modal").size()>0){e("div.modal-body").html(e.ajaxResponse.responseText).trigger("create"),e.ajaxResponse.responseText="";var t=e("form#"+e("div.modal-body").find("form").attr("id"));t.find(".dropdown-toggle").dropdown(),t.find(".checkbox-custom").checkbox("enable"),t.find(".combobox").combobox("enable"),t.find(".infinitescroll").infinitescroll("enable"),t.find(".loader").loader("reset"),t.find(".pillbox").pillbox(),t.find(".placard").placard("enable"),t.find(".radio").radio("enable"),t.find(".search").search("enable"),t.find(".selectlist").selectlist("enable"),t.find(".spinbox").spinbox(),t.find(".tree").tree("render"),t.find(".wizard").wizard(),t.find(".repeater").repeater("render"),t.find(".datepicker").each(function(){var a=e(this).attr("id").replace("entry-data-","").split("-"),r=a[0],n=t.find('input[name="custom-database-tables['+r+'][prev_date]"]').val();e(this).datepicker({date:new Date(n),allowPastDates:!0,restrictDateSelection:!0,momentConfig:{culture:e(this).data("momentLocale"),format:e(this).data("momentFormat")}}),e.onTimer=!1}),e("div.modal-body").find("input,textarea,select").each(function(){"undefined"!=typeof e(this).attr("required")&&e(this).prop("required",!0)})}},this.submit_data_deletion=function(){var t=[];e("tr.selectable.selected input.row_where_condition").each(function(){t.push(e(this).val())});var a=e.ajaxResponse.responseText,r='<form method="post" action="'+location.href+'" id="data-deletion-'+a+'" style="display: none;">';r+='<input type="hidden" name="action" value="delete_data">',r+='<input type="hidden" name="table" value="'+_.last(e.sessionKey.split("-"))+'">',r+='<input type="hidden" name="_wpnonce" value="'+a+'">',r+='<input type="hidden" name="where_conditions" value="'+t.join(",")+'">',r+="</form>",e("#cdbtDeleteData .modal-body").append(r);var n=e("#cdbtDeleteData .modal-body").find("#data-deletion-"+a);setCookie("once_action",n.attr("id")),n.submit()},this.set_global_var=function(){}},a=new t,r=function(){var t={};arguments.length>0&&(t=arguments[0]),e("div.cdbt-modal").size()>0&&(e("div.cdbt-modal").remove(),e("#append-dynamic-modal").remove()),l(e.ajaxUrl,"post",_.extend(t,{event:"retrieve_modal"}),"html","render_modal"),e(document).on("hide.bs.modal","div.cdbt-modal, #append-dynamic-modal",function(){e(".cdbt-entry-data-form").size()>0&&(""!==e("#cdbt-entry-redirection").val()?location.replace(e("#cdbt-entry-redirection").val()):location.replace(location.href))})};"undefined"!=typeof wizard&&e("#welcome-wizard").wizard();var n=function(t){if(1===e("form#"+t).size()){var a=0,r=0;return e("form#"+t).find(".form-group").each(function(){if(e(this).find(".required").size()>0||e(this).find(".cdbt-form-required").size()>0){a+=1;var t=0,n=0;e(this).find(".checkbox").size()>0?(e(this).find(".checkbox-custom").each(function(){e(this).checkbox("isChecked")&&t++}),0===t&&r++):e(this).find(".selectlist").size()>0?e(this).find(".selectlist").selectlist("selectedItem").selected||r++:e(this).find('input[type="text"]').size()>0?(e(this).find('input[type="text"]').each(function(){""!==e(this).val()&&n++}),n!==e(this).find('input[type="text"]').size()&&r++):e(this).find('input[type="number"]').size()>0?(e(this).find('input[type="number"]').each(function(){""!==e(this).val()&&n++}),n!==e(this).find('input[type="number"]').size()&&r++):e(this).find("textarea").size()>0?(e(this).find("textarea").each(function(){""!==e(this).val()&&n++}),n!==e(this).find("textarea").size()&&r++):e(this).find('input[type="file"]').size()>0}}),0===a||0===r?!0:!1}return!0};if("undefined"!=typeof repeater){_.each(repeater,function(e,t){return repeater[t]()});var i=function(){e(".table-frozen tr").removeAttr("style"),e(".repeater table tr").each(function(){e(this).children("th").removeAttr("style"),e(this).children("td").removeAttr("style"),e(this).find(".repeater-list-heading").removeAttr("style"),e(".repeater-list-heading").each(function(){e(this).css("width",e(this).parent("th").width()+16+"px")})});var t=0;e(".repeater-list-wrapper>table tr").each(function(){var a=e(this).height()+1;e(this).css("height",a+"px"),e(".table-frozen tr").eq(t).css("height",a+"px"),t++})},o=0===e(".repeater").attr("id").indexOf("cdbt-repeater-view-"),d=0===e(".repeater").attr("id").indexOf("cdbt-repeater-edit-");if(o||d){e(".dropdown-toggle").dropdown(),e(document).on("rendered.fu.repeater",".repeater",function(t){e(this).find(".sorted").removeClass("sorted");var a,r,n=e(this).data("cols").split(","),i="function"==typeof getCookie?getCookie("cdbtSortCache"):"",o=JSON.parse(i);"object"==typeof o&&_.size(o)>0&&"undefined"!=typeof o[e(this).attr("id")]?(a=d?n[o[e(this).attr("id")][0]]:n[o[e(this).attr("id")][0]],r=o[e(this).attr("id")][1]):(a=e(this).data().currentSortCol,r=e(this).data().currentSortDirection),_.contains(n,a)&&e(this).find("thead th.sortable").each(function(){var t=_.indexOf(n,a);if(t=d?t+1:t,e(this).index()===t){e(this).addClass("sorted").find(".sortable").addClass("sorted");var i="asc"===r?"up":"down";e(this).find(".rlc").attr("class","glyphicon rlc glyphicon-chevron-"+i)}else e(this).find(".rlc").attr("class","glyphicon rlc")})}),e(document).on("click",".repeater-views",function(){i()}),e(document).on("click","th.sortable",function(t){var a,r,n,o=e(this).parents(".repeater"),s="function"==typeof getCookie?getCookie("cdbtSortCache"):"",c=o.data("cols").split(","),l=d?e(this).index()-1:e(this).index();if(""!==s){var u=JSON.parse(s);"object"==typeof u&&_.size(u)>0&&"undefined"!=typeof u[o.attr("id")]?(a=u[o.attr("id")][0],r=u[o.attr("id")][1],a!==l?a=l:o.data().currentSortDirection=r,o.data().currentSortCol=c[a]):(a=l,o.data().currentSortCol=c[a],r=o.data().currentSortDirection),n="desc"===r?"asc":"desc"}else a=l,o.data().currentSortCol=c[a],r=o.data().currentSortDirection,n="desc"===r?"asc":"desc";s={},s[o.attr("id")]=new Array(a,n,String(t.timeStamp)),setCookie("cdbtSortCache",JSON.stringify(s)),o.repeater("render"),i()}),e(document).on("click",".modal-preview",function(){var t=e(this).children("img").attr("src"),a="",n={id:"cdbtModal",insertContent:!0,modalTitle:"",modalBody:""};if("undefined"!=typeof t)0===t.indexOf("data:")&&(a=t),n.modalTitle="image_preview",n.modalSize="large",n.modalBody='<div class="preview-image-body"><img src="'+a+'" class="center-block"></div>';else{var i=e(this).parents(".repeater").attr("id");a=e(this).text(),n.modalTitle="binary_downloader",n.modalExtras={table_name:i.substr(i.lastIndexOf("-")+1),target_column:e(this).attr("data-column-name"),where_clause:e(this).attr("data-where-conditions")}}r(n)});var s=function(t){var a=e("#"+t).repeater("list_getSelectedItems"),r=e("#"+t+" button#repeater-editor-edit"),n=e("#"+t+" button#repeater-editor-delete");1===a.length?(r.attr("class","btn btn-primary").removeAttr("disabled"),n.attr("class","btn btn-default")):a.length>1?(r.attr("class","btn btn-default").attr("disabled","disabled"),n.attr("class","btn btn-primary")):(r.attr("class","btn btn-default").removeAttr("disabled"),n.attr("class","btn btn-default"))};e('.repeater[id^="cdbt-repeater-edit-"]').on("selected.fu.repeaterList deselected.fu.repeaterList",function(t){s(e(t.target).attr("id"))}),e(document).on("click","#repeater-check-switch",function(t){s(e(t.target).attr("id"))}),e(document).on("click",'button[id^="repeater-editor-"]',function(){var t=_.last(e(this).attr("id").split("-")),a=_.last(e(this).parents(".repeater").attr("id").split("-")),n=e(this).parents(".repeater").repeater("list_getSelectedItems"),i={};switch(e.sessionKey="cdbt-edit-"+a,$common_modal_hide="$('input[name=\"custom-database-tables[operate_action]\"]').val('edit'); $('form.navbar-form').trigger('submit');",t){case"refresh":return i={session_key:e.sessionKey,default_action:"edit",target_table:a,event:"reload_page",callback_url:window.location.href},l(e.ajaxUrl,"post",i,"script");case"edit":i={id:"cdbtEditData",insertContent:!0,modalTitle:"",modalBody:""},0===n.length?(i.id="cdbtEditWarning",i.modalTitle="no_selected_item"):n.length>1?(i.id="cdbtEditWarning",i.modalTitle="too_many_selected_item"):(i.modalSize="large",i.modalTitle="edit_data_form",i.modalExtras={table_name:a,action_url:window.location.href,where_clause:e("tr.selectable.selected input.row_where_condition").val()}),e.ajaxResponse.targetTable=a,r(i);break;case"delete":i={id:"cdbtDeleteData",insertContent:!0,modalTitle:"",modalBody:"",modalExtras:{items:n.length}},0===n.length?i.modalTitle="no_selected_item":i.modalTitle="delete_data",r(i);break;default:return!1}}),e(document).on("show.bs.modal","#cdbtEditData",function(){var t={session_key:e.sessionKey,table_name:_.last(e.sessionKey.split("-")),operate_action:"edit_data",event:"render_edit_form",shortcode:"["+e("#edit-data-form").val()+"]"};return l(e.ajaxUrl,"post",t,"html","load_into_modal")}),e(document).on("change","#cdbtEditData div.cdbt-entry-data-form form .checkbox-custom input",function(){if(e(this).parent().hasClass("multiple")){var t=e('input[name="'+e(this).attr("name").replace("[]","")+'[checked]"]'),a=Number(t.val());e(this).prop("checked")?a+=1:a-=1,a=0>a?0:a,t.val(a)}});e(document).on("click","#run_update_data",function(t){t.preventDefault();var a=e("#cdbtEditData div.cdbt-entry-data-form form"),r=a.attr("id");a.children('input[name="_wp_http_referer"]').val(location.href),n(r)?(setCookie("once_action",a.attr("id")),a.submit()):(e(this).popover({animation:!0,content:e.localErrMsg,placement:"top",trigger:"hover"}).popover("show"),e(this).on("hidden.bs.popover",function(){e(this).popover("destroy")}))}),e(document).on("click","#run_delete_data",function(){e("#run_delete_data").off();var t={table:_.last(e.sessionKey.split("-")),event:"retrieve_nonce"};return l(e.ajaxUrl,"post",t,"text","submit_data_deletion")})}i()}if(e(".cdbt-datepicker").size()>0){var c=e("form#"+e(".cdbt-datepicker").parents("form").attr("id"));c.find(".cdbt-datepicker").each(function(){e(this).data().momentLocale&&e(this).data().momentFormat&&e(this).datepicker({momentConfig:{culture:e(this).data().momentLocale,format:e(this).data().momentFormat}}),"undefined"==typeof e(this).data("date")?e(this).datepicker("getDate",new Date):e(this).datepicker("setDate",e(this).data("date"));var t=e(this).parent().next("input[type=hidden]").val();"0000-00-00 00:00:00"===t?e.onTimer=!0:e.onTimer=!1}),setInterval(function(){"use strict";a.reload_timer()},1e3)}e(".cdbt-entry-data-form form").size()>0&&(e(".dropdown-toggle").dropdown(),e(".cdbt-entry-data-form form .checkbox-custom").on("checked.fu.checkbox unchecked.fu.checkbox",function(){if(e(this).hasClass("multiple")){var t=e('input[name="'+e(this).children("input").attr("name").replace("[]","")+'[checked]"]'),a=Number(t.val());e(this).checkbox("isChecked")?a+=1:a-=1,t.val(a)}}),e(document).on("click",'button[id^="btn-entry/"]',function(t){t.preventDefault();var a=e(this).attr("id").split("/"),i=e("#"+a[1]),o=n(a[1]);i.find(".checkbox-custom").each(function(){if(e(this).hasClass("multiple")&&e(this).hasClass("required")){var t=e('input[name="'+e(this).children("input").attr("name").replace("[]","")+'[checked]"]'),a=Number(t.val());0===a&&(o=!1)}}),o?(setCookie("once_action",i.attr("id")),i.submit()):(m={id:"cdbtModal",insertContent:!0,modalTitle:"empty_required_field",modalBody:""},r(m))})),"undefined"!=typeof dynamicTable&&_.each(dynamicTable,function(e,t){return dynamicTable[t]()});var l=function(){if(arguments.length<2)return!1;var t=arguments[0],r=arguments[1],n="undefined"!=typeof arguments[2]?arguments[2]:null,i="undefined"!=typeof arguments[3]?arguments[3]:"text",o="undefined"!=typeof arguments[4]?arguments[4]:null,d="undefined"!=typeof arguments[5]?arguments[5]:null,s="undefined"!=typeof arguments[6]?arguments[6]:null,c={async:!0,url:t,type:r,data:n,dataType:i,cache:!1,beforeSend:function(e,t){}};null!==d&&c.append("processData",d),null!==s&&c.append("contentType",s);var l=e.ajax(c);l.done(function(t,r,n){return e.isDebug&&console.log({done:r,data:t,xhr:n}),"script"===i?t:(e.ajaxResponse={responseText:l.responseText,status:l.status,statusText:l.statusText},""!==o?a[o]():void 0)}),l.fail(function(t,a,r){e.isDebug&&console.log({fail:a,error:r,xhr:t})}),l.always(function(t,a,r){e.isDebug&&console.log({always:a,res1:t,res2:r})})};if(""!==e.emitMessage){var u="notice"===e.emitType?"notices_updated":"notices_error",m={id:"cdbtModal",insertContent:!0,modalTitle:u,modalBody:e.emitMessage,modalHideEvent:"$('#cdbtModal .modal-body').html(''); $('#cdbtModal').remove(); $.emitMessage = cdbt_main_vars.emit_message = ''; $.emitType = 'error';"};r(m),e.emitMessage=cdbt_main_vars.emit_message="",e.emitType="error"}e(document).on("click","a.collapse-col-data",function(){m={id:"cdbtModal",insertContent:!0,modalTitle:"view_item_full",modalBody:e(this).data("raw")},r(m)})});var convert_datetime=function(){if(arguments.length<2)return 1===arguments.length?arguments[0]:!1;if("undefined"==typeof arguments[0]||!arguments[0])return"-";var e=arguments[0].replace(/\-/g,"/"),t=new Date(e),a=arguments[1].join(" ");if(""===a)return arguments[0];var r=a.split(""),n="",i=function(e){var t=new Date(e.getFullYear(),e.getMonth()+1,1);return t.setTime(t.getTime()-1),t.getDate()},o=function(){for(var e=new Date(t.getFullYear(),0,1),a=0,r=0;12>r;r++)e.setMonth(r),a+=i(e);return 365===a?0:1},d=function(){for(var e=new Date(t.getFullYear(),0,1),a=-1,r=0;r<t.getMonth();r++)e.setMonth(r),a+=i(e);return a+t.getDate()};return _.each(r,function(e){var a,r={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"},s={Sun:"Sunday",Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thurseday",Fri:"Friday",Sat:"Saturday"},c=function(){var e=t.getHours();return e>12?e-12:e},l=function(){var e=t.getHours();return e>12?"pm":"am"};switch(e){case"Y":case"o":a=t.getFullYear();break;case"y":a=(""+t.getFullYear()).slice(-2);break;case"m":a=("0"+(t.getMonth()+1)).slice(-2);break;case"n":a=t.getMonth()+1;break;case"F":a=_.values(r)[t.getMonth()];break;case"M":a=_.keys(r)[t.getMonth()];break;case"d":a=("0"+t.getDate()).slice(-2);break;case"j":a=t.getDate();break;case"S":var u=["st","nd","rd","th"],m=function(){var e=t.getDate();return 1===e||2===e||3===e||21===e||22===e||23===e||31===e?Number((""+e).slice(-1)-1):3};a=u[m()];break;case"w":case"W":a=t.getDay();break;case"l":a=_.values(s)[t.getDay()];break;case"D":a=_.keys(s)[t.getDay()];break;case"N":a=0===t.getDay()?7:t.getDay();break;case"a":a=l();break;case"A":a=l().toUpperCase();break;case"g":a=c();break;case"h":a=("0"+c()).slice(-2);break;case"G":a=t.getHours();break;case"H":a=("0"+t.getHours()).slice(-2);break;case"i":a=("0"+t.getMinutes()).slice(-2);break;case"s":a=("0"+t.getSeconds()).slice(-2);break;case"z":a=d();break;case"t":a=i(t);break;case"L":a=o();break;case"c":a=arguments[0].replace(" ","T")+"+00:00";break;case"r":a=t;break;case"u":a="000000";break;case"e":case"T":case"B":case"I":case"O":case"P":case"Z":case"U":a="";break;default:a=e}n+=a}),n},isSurrogatePear=function(e,t){return e>=55296&&56319>=e&&t>=56320&&57343>=t},mb_strlen=function(e){for(var t=0,a=0;a<e.length;a++,t++){var r=e.charCodeAt(a),n=e.length>a+1?e.charCodeAt(a+1):0;isSurrogatePear(r,n)&&a++}return t},mb_substr=function(e,t,a){for(var r="",n=0,i=0;n<e.length;n++,i++){var o=e.charCodeAt(n),d=e.length>n+1?e.charCodeAt(n+1):0,s="";isSurrogatePear(o,d)?(n++,s=String.fromCharCode(o,d)):s=String.fromCharCode(o),i>=t&&a>i&&(r+=s)}return r},strip_tags=function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var a=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,r=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return e.replace(r,"").replace(a,function(e,a){return t.indexOf("<"+a.toLowerCase()+">")>-1?e:""})},cdbtCustomColumnFilter=function(e,t){t=t||100;var a=$("<div/>").html(strip_tags(_.unescape(e),"<a><b><strong><em><i>")).text();if(mb_strlen(a)>t){var r=mb_substr(a,0,t-1);e=r+'<a href="javascript:;" class="btn btn-default btn-sm collapse-col-data" data-raw="'+e+'">...<span class="caret"></span></a>'}else e=a;return e};
//# sourceMappingURL=cdbt-main.js.map
